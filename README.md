# Team 6ixSense -osulloc Clone coding - refactoring

## 프로젝트 개요

### 오설록 사이트 분석

🍵 **[Producting]**

1. 오설록은 제주특별자치도에 본사를 둔 대한민국의 차업체이며, 대표적인 브랜드 중 하나입니다.
2. 다양한 차와 차 관련 상품들을 판매하고 있으며, 특히 제주도에서 직접 재배한 녹차가 유명합니다.
3. 신선한 녹차 외에도 다양한 녹차 기반 제품들(녹차 초콜릿, 녹차 아이스크림 등)을 판매하며, 차 문화를 널리 알리고 있습니다.
4. 또한, 오설록은 제주의 아름다운 자연을 체험할 수 있는 티 뮤지엄을 운영하고 있어, 브랜드 체험 및 차문화 확산에 크게 기여하고 있습니다.
5. 웹 및 모바일 서비스
   1. 제품 구매를 위한 웹페이지를 제작하고 있으며, 이를 통해 각종 제품 정보와 구매 서비스를 제공합니다.
   2. 네비게이션바에서 "제품"을 중심으로 각 분야별 상품들을 확인할 수 있게 제작되어 있으며, 웹사이트 내 검색 기능을 통해 원하는 제품을 쉽게 찾을 수 있습니다.

👤 **[End-User]**

1. 차를 즐기는 모든 고객
   1. 녹차를 포함한 다양한 차를 선호하는 고객
   2. 제주도 특산품을 선호하고, 선물을 구매하는 고객
   3. 새로운 차문화를 체험하고, 차에 대한 지식을 넓히고 싶은 고객
   4. 차 관련 상품을 선호하는 고객

### 식스센스 사이트 분석

🕯️ **[Producting]**

1. 식스센스 사이트는 다양한 인센스 제품을 판매하는 온라인 플랫폼입니다.
1. 코로나로 인하여 집콕 생활이 장기화 되면서 20~30대를 중심으로 인센스 제품의 인기가 높아짐
2. 2021년 7월 1일부터 11일까지의 CJ올리브영 매출 자료에 따르면, 인센스 스틱의 매출이 3월 20일~ 6월 30일 대비 92% 급증

👤 **[End-User]**

1. 다양한 향의 인센스를 선호하는 고객
2. ‘디깅족’ 뚜렷한 취향과 목적에 맞는 선호 품목을 깊게 파고들어 구매하는 소비자
3. 자기의 공간을 자신만의 냄새로 꾸미고 싶어하는 고객
4. 인센스 상품을 선물 하고 싶어하는 고객
<br />

프로젝트 기간: 2023.04.03 ~ 2023.04.14

## FrontEnd

- <a href="https://github.com/Hyomins-013">신효민<img src="https://img.shields.io/badge/GitHub-181717?style=flat-square&logo=GitHub&logoColor=white&link=https://github.com/hongyeollee"/></a>
- <a href="https://github.com/alchogh">조건호<img src="https://img.shields.io/badge/GitHub-181717?style=flat-square&logo=GitHub&logoColor=white&link=https://github.com/hongyeollee"/></a>
- <a href="https://github.com/Hyoster">박효성<img src="https://img.shields.io/badge/GitHub-181717?style=flat-square&logo=GitHub&logoColor=white&link=https://github.com/hongyeollee"/></a>

<br />

## BackEnd

- <a href="https://github.com/parkseyik">박세익 <img src="https://img.shields.io/badge/GitHub-181717?style=flat-square&logo=GitHub&logoColor=white&link=https://github.com/minseoya"/></a>
- <a href="https://github.com/thornewater">김원종<img src="https://img.shields.io/badge/GitHub-181717?style=flat-square&logo=GitHub&logoColor=white&link=https://github.com/lsg622"/></a>
- <a href="https://github.com/songsong95">송석준<img src="https://img.shields.io/badge/GitHub-181717?style=flat-square&logo=GitHub&logoColor=white&link=https://github.com/Dongrang072"/></a>

<br/>

<div align=center><h1>📚 STACKS</h1></div>

<div align=center>

  <img src="https://img.shields.io/badge/html5-E34F26?style=for-the-badge&logo=html5&logoColor=white"> 
  <img src="https://img.shields.io/badge/css-1572B6?style=for-the-badge&logo=css3&logoColor=white"> 
  <img src="https://img.shields.io/badge/javascript-F7DF1E?style=for-the-badge&logo=javascript&logoColor=black">
  <br>
  <img src="https://img.shields.io/badge/mysql-4479A1?style=for-the-badge&logo=mysql&logoColor=white"> 
  <img src="https://img.shields.io/badge/.ENV-ECD53F?style=for-the-badge&logo=.ENV&logoColor=black">
  <img src="https://img.shields.io/badge/node.js-339933?style=for-the-badge&logo=Node.js&logoColor=white">
  <img src="https://img.shields.io/badge/express-000000?style=for-the-badge&logo=express&logoColor=white">
  <img src="https://img.shields.io/badge/nestjs-E0234E?style=for-the-badge&logo=nestjs&logoColor=black"> 
  <img src="https://img.shields.io/badge/swagger-85EA2D?style=for-the-sbadge&logo=swagger&logoColor=black"> 
  <img src="https://img.shields.io/badge/Postman-FF6C37?style=for-the-badge&logo=Postman&logoColor=white">
  <img src="https://img.shields.io/badge/amazonaws-232F3E?style=for-the-badge&logo=amazonaws&logoColor=white">
  <img src="https://img.shields.io/badge/amazonec2-FF9900?style=for-the-badge&logo=amazonec2&logoColor=white">
  <img src="https://img.shields.io/badge/docker-2496ED?style=for-the-badge&logo=docker&logoColor=white">
  <br>
  <img src="https://img.shields.io/badge/trello-61DAFB?style=for-the-badge&logo=trello&logoColor=black"> 
  <img src="https://img.shields.io/badge/github-181717?style=for-the-badge&logo=github&logoColor=white">
  <img src="https://img.shields.io/badge/git-F05032?style=for-the-badge&logo=git&logoColor=white">
  <img src="https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=Slack&logoColor=white">

  </div>

#

# 식스센스 - 리팩토링 진행

1. 프레임워크 변경: Express에서 NestJS로 변경

   - 전체 애플리케이션 구조를 NestJS의 구조에 맞게 변경하였습니다. 이를 통해 코드의 안정성과 유지보수성이 향상되었습니다.
   - 기존의 RawQuery형태를 QueryBuilder로 변경
     - 데이터베이스 쿼리 작성에 TypeORM의 createQueryBuilder를 사용하여 작성하였습니다. 기존의 RAW 쿼리를 보다 직관적이고 간결하게 작성하였습니다.

2. 회원가입, 로그인

   - 회원가입: 유저의 정보를 받아 데이터베이스에 저장합니다.
   - 로그인: 유저로부터 이메일과 패스워드를 받아, 데이터베이스에 저장된 정보와 비교하여 인증을 진행합니다.

3. productList 페이지네이션, 상품 필터링

   - 페이징: 유저가 원하는 페이지의 상품을 불러올 수 있도록 페이징 기능을 구현하였습니다.
   - 필터링: 상품의 카테고리, 가격, 인기도 등에 따라 상품을 필터링 할 수 있는 기능을 구현하였습니다.

4. productDetailPage 페이지네이션

   - productDetailPage는 유저가 상품에 대한 상세 정보를 확인할 수 있는 페이지입니다.

5. 장바구니 CRUD API

6. 주문 API

Type 확인에는 Nestia를 사용하였습니다.

- 이전의 NestJs에서는 class-validator를 사용했지만, Nestia는 class-validator보다 약 20,000배 빠릅니다.
- Swagger 문서 자동화를 통해 가독성이 좋은 코드를 생성할 수 있습니다.
- 출처 - [Nestia 공식 문서](https://nestia.io/docs/)

7. 보안강화
- 문제: 보안 취약성
    - 기존의 JWT토큰을 헤더에서 넘기는 방식은 보안성에 취약한 부분이 존재하지만 그부분에 대한 보안대책을 설계하지 못함
    - 토큰이 저장되는 공간 (Local Storage, Session Storage 등)에 대한 접근이 제한되지 않기 때문에 토큰의 보안을 확실하게 보장하는 것이 어려움
    - XSS 공격에 취약하여, 악성 스크립트가 클라이언트의 토큰을 탈취할 위협이 존재
- 해결방법: 
     - JWT토큰을 헤더에서 넘기는 방식에서 쿠키로 넘겨주는 방식으로 전환하였습니다.
     - 쿠키의 보안설정으로 signed, maxAge, httpOnly, Secrert Key 설정을 추가하여 CSRF공격과 XSS공격에 대해서 보안을 강화하였습니다.
     - JWT 토큰이 탈취당하면 유효 기간 만료 전까지 유효하여 보안 위협이 있기 때문에, JWT 토큰의 보안 설정을 추가하였습니다.  issuer 설정, audience 설정을 추가하였습니다.
     - xss-clean 라이브러리사용. xss-clean은 미들웨어 라이브러리로 HTTP요청의 데이터를 정제하여 XSS공격을 방어하는 라이브러리입니다. 해당 라이브러리를 사용하여 보안성을 강화하였습니다.
     - helmet 라이브러리를 사용하여 보안성을 강화하였습니다.
     - HTTPS 도입
        - 쿠키의 보안과 스니핑방지를 위해 가비아에서 도메인을 구매하고 Nginx와 Let's Encrypt를 활용해서 백엔드 서버에 HTTPS를 도입하였습니다.

swagger문서화

- https://app.swaggerhub.com/apis/ASDQWE747/1st-project_re/0.0.1#/order

<br/>

# 회원가입, 로그인 API

![signup](https://user-images.githubusercontent.com/123849268/232360555-3188c6df-31dc-4627-9717-161ac49a2c35.gif)
![logingif](https://user-images.githubusercontent.com/123849268/232360579-23392ced-1c12-43a8-9980-806d6a6e4270.gif)

## 구현 목표

고객의 회원가입, 로그인 및 인증 기능을 구현. Argon2를 활용한 비밀번호 보안 강화와 JWT를 이용하였습니다.

## 구현 사항 설명

<div style="text-align: left">
1. 회원가입
</div>

고객은 이름, 계정, 비밀번호, 전화번호, 생일, 성별을 입력하여 회원가입을 진행할 수 있습니다. 여기서 계정은 4~12자의 영문과 숫자로 구성되며, 비밀번호는 8~16자의 영문, 숫자, 특수문자로 구성됩니다.

비밀번호 암호화 Argon2를 사용하였습니다.

- Argon2는 최신의 해싱 알고리즘이며, 시스템 리소스에 따라 보안 수준을 최적화할 수 있어 선택하였습니다.

<div style="text-align: left">
2. 로그인 기능 
</div>

Argon2를 통해 해시된 비밀번호를 비교하여 계정의 유효성을 검증하고, 인증이 성공하면 JWT 토큰을 생성하여 쿠키로 반환합니다.

JWT 토큰이 탈취당하면 유효 기간 만료 전까지 유효하여 보안 위협이 있습니다. 따라서 보안 설정을 추가하여 JWT 토큰의 보안성을 높였습니다. JWT 토큰 보안 설정은 secret 키 설정, issuer 설정, audience 설정 등을 포함합니다.

기존의 토큰을 헤더에서 넘기는 방식은 보안성에 취약한 부분이 있습니다.

1.  XSS공격에 취약하여, 악성 스크립트가 클라이언트의 토큰을 탈췰할 위협이 존재합니다.
2.  토큰이 저장되는 공간(Local Storage, Session Storage 등)에 대한 접근이 제한되지 않기 때문에 토큰의 보안을 확실하게 보장이 어렵습니다.

그래서 토큰을 헤더에서 넘기는 방식에서 쿠키로 넘기는 방식으로 변경하였습니다.

쿠키 보안 설정은 signed 설정, maxAge 설정, sameSite 설정, httpOnly 설정 등을 포함합니다. 이러한 설정을 통해 쿠키의 보안성을 높였습니다.
<br/>

# productList 페이지네이션, 상품 필터링

![main_2 (1)](https://user-images.githubusercontent.com/123849268/232360878-481bf06a-b1a6-46bf-a0dd-bdd46126256b.gif)
![listgif](https://user-images.githubusercontent.com/123849268/232360953-d8050f34-fbae-4f7a-97a3-cad522116124.gif)

## 구현 목표

페이지 네이션 및 필터링기능추가

## 구현 사항 설명

1. 상품의 가격을 정렬하여 낮은 가격순, 높은 가격순으로 선택할 수 있는 API를 구현했습니다.
2. 상품의 카테고리별로 필터링하여 상품을 선택할 수 있도록 구현했습니다.
3. 상품 이미지를 선택할 시, Product Image와 Hover Image를 함께 제공하기 위해 상품 정보에 두 개의 이미지 URL을 추가하고 클라이언트 측에서 이를 구현했습니다.
4. LIMIT와 OFFSET으로 페이지네이션을 적용하여 페이지 이동을 구현했습니다.

<br>

# productDetailPage

![상품 디테일 (1)](https://user-images.githubusercontent.com/120084509/232380947-5492f3c1-cae6-4177-9572-ad3a87a75dd6.gif)

## 구현 목표

1. 상세 상품 정보 조회 기능 제공
2. QueryBuilder 활용으로 가독성 및 보안성 향상

## 구현 사항 설명

1. 상품 정보 조회 기능

상품 이름, 가격, 상세 정보, 이미지 등 데이터베이스에 저장된 정보를 클라이언트로 반환합니다.

# 장바구니 CRUD API

![장바구니_선택체크 (1)](https://user-images.githubusercontent.com/120084509/232398090-45afe96d-5677-433b-b32d-108bfd3b014b.gif)

![장바구니_전체선택_삭제 (1)](https://user-images.githubusercontent.com/120084509/232398104-2d7794ae-551d-425a-8b3b-b6d3338fe754.gif)

![장바구니_선택삭제 (1)](https://user-images.githubusercontent.com/120084509/232398127-d1e0a226-254e-49c0-834c-a34916ae5d8c.gif)

## 구현 목표

장바구니 CRUD 기능 추가

## 구현 사항 설명

1. 쿠키 내에 저장된 토큰을 통해 사용자를 인증하였습니다. 토큰이 없으면 API 호출이 불가능합니다.
2. 유저가 구매를 원하는 상품을 효율적으로 관리 할수 있도록 CRUD기능구현하였습니다.
3. 장바구니에 물품 추가 시에 장바구니 내에 해당 productId가 존재하는 경우 클라이언트가 요청한 quantity로 변경하여 유저들의 편의성 증대 시켰습니다.
4. 장바구니 상품이 부분 선택하여 삭제 및 수량 업데이트 시에도 DB 내에서 반영할 수 있도록 구현하였습니다.

<br>

# 주문 & 결제 API

![ezgif com-gif-maker (3)](https://user-images.githubusercontent.com/120084509/232380925-f400bdf0-0a9f-4b70-8756-7ecf1d38eec1.gif)

## 구현 목표

주문 & 결제 기능 추가

## 구현 사항 설명

1. JWT 토큰을 활용해 인증된 사용자만이 서비스를 이용하도록 구현했습니다.
2. 실제 거래가 이루어지는 사이트가 아니므로 결제 시스템은 사용자가 보유한 포인트에서 구매하려는 상품의 총 가격만큼 차감하는 방식을 선택했습니다.
3. 만일 사용자가 현재 보유하고 있는 포인트보다 구매하려는 상품의 가격이 더 큰 경우에는 오류를 반환하도록 했습니다.
4. 장바구니 단계에서는 사용자가 전체 장바구니를 구매하는 것이 아닌, 선택한 상품만 구매할 수 있도록 하였으며, 이에 따라 사용자가 구매한 상품만 장바구니 정보에서 삭제되도록 구현했습니다.
